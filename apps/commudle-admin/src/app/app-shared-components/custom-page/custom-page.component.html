<div class="create-button">
  <button nbButton status="primary" (click)="openCreateNewPageDialog(createNewFormDialog)">Create New Page</button>
</div>

<table>
  <tr>
    <th>Title</th>
    <th>Description</th>
    <th>Published</th>
    <th>Slug</th>
    <th>User</th>
    <th>Actions</th>
  </tr>
  <tr *ngFor="let page of pages; let i = index">
    <td>
      <a [routerLink]="['../', page.slug]">{{ page.title }}</a>
    </td>
    <td>{{ page.description }}</td>
    <td>
      <div class="published">
        <span>{{ page.published }}</span>
        <nb-toggle [checked]="page.published" (click)="togglePublished(page.id, i)"></nb-toggle>
      </div>
    </td>
    <td>{{ page.slug }}</td>
    <td>
      <app-user-profile-card-small [user]="page.user"></app-user-profile-card-small>
    </td>
    <td class="action">
      <button (click)="openCreateNewPageDialog(createNewFormDialog, page, i)" nbButton status="primary" size="tiny">
        <nb-icon icon="edit"></nb-icon> Edit
      </button>
      <button (click)="destroy(page.id, i)" nbButton status="danger" outline size="tiny">
        <nb-icon icon="close"></nb-icon> delete
      </button>
    </td>
  </tr>
</table>

<ng-template #createNewFormDialog let-data let-ref="dialogRef">
  <nb-card>
    <nb-card-header>
      <h6>{{ data.page ? 'Edit page' : ' Create new page' }}</h6>
      <button ghost nbButton size="small" (click)="closeDialogBox()">
        <nb-icon icon="close"></nb-icon>
      </button>
    </nb-card-header>
    <nb-card-body>
      <form [formGroup]="customPageForm">
        <div class="title">
          <label for="title">Title*</label>
          <input type="text" formControlName="title" nbInput fullWidth />
          <commudle-alert
            *ngIf="
              customPageForm.controls['title'].touched &&
              customPageForm.controls['title'].errors?.required &&
              customPageForm.controls['title'].invalid
            "
            errorMessage="Title is Required"
            [error]="true"
          ></commudle-alert>
        </div>
        <div class="discription">
          <label for="description">Description*</label>
          <textarea formControlName="description" nbInput fullWidth></textarea>
          <commudle-alert
            *ngIf="
              customPageForm.controls['description'].touched &&
              customPageForm.controls['description'].errors?.required &&
              customPageForm.controls['description'].invalid
            "
            errorMessage="Description is Required"
            [error]="true"
          ></commudle-alert>
        </div>
        <div class="published">
          <label for="published">Published*</label>
          <nb-toggle formControlName="published"></nb-toggle>
        </div>
        <div class="content">
          <label for="content">Content*</label>
          <editor formControlName="content" apiKey="e34vgv7ocd6ttka8t6qcd07g7lifas1y9lyve8ze1013nefs" [init]="tinyMCE">
          </editor>
          <commudle-alert
            *ngIf="
              customPageForm.controls['content'].touched &&
              customPageForm.controls['content'].errors?.required &&
              customPageForm.controls['content'].invalid
            "
            errorMessage="Content is Required"
            [error]="true"
          ></commudle-alert>
        </div>
      </form>
    </nb-card-body>
    <nb-card-footer>
      <button
        nbButton
        status="primary"
        (click)="data.page ? update(data.page.id, data.index) : create()"
        [disabled]="!customPageForm.valid || !customPageForm.dirty"
      >
        Save
      </button>
      <button nbButton status="danger" (click)="closeDialogBox()">cancel</button>
    </nb-card-footer>
  </nb-card>
</ng-template>
