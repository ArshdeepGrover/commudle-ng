<button nbButton status="info" (click)="open(dialog)">Create Discount Coupon</button>

<div>
  <table>
    <tr>
      <th>Code Name</th>
      <th>Expire At</th>
      <th>Action</th>
      <th>Share</th>
    </tr>
    <tr *ngFor="let discountCode of discountCodes">
      <td>{{ discountCode.code }}</td>
      <td>{{ discountCode.expires_at | date : 'dd-MM-yy hh:mm a' }}</td>
      <td><button nbButton size="tiny" (click)="open(dialog, discountCode)" outline status="primary">Edit</button></td>
      <td>
        <app-share-button
          [content]="discountCode.code"
          [title]="discountCode.code"
          [text]="discountCode.code"
          [url]="discountCode.code"
          [showText]="false"
          [round]="false"
        ></app-share-button>
        <!-- <button nbButton size="tiny" outline status="primary"></button> -->
      </td>
    </tr>
  </table>
</div>

<ng-template #dialog let-data let-ref="dialogRef">
  <nb-card class="com-h-[80dvh] com-w-full">
    <nb-card-header>
      <div class="com-flex com-justify-between">
        <div>{{ data.type | titlecase }} Discount Coupon</div>

        <button (click)="ref.close(); discountCouponForm.reset()" ghost nbButton shape="round" size="small">
          <nb-icon icon="close"></nb-icon>
        </button>
      </div>
    </nb-card-header>
    <nb-card-body>
      <form [formGroup]="discountCouponForm">
        <div formGroupName="discount_code" class="com-flex com-flex-col com-gap-3">
          <!-- Name -->
          <label>
            Name*
            <input formControlName="code" fullWidth nbInput type="text" placeholder="Coupon Name" />
          </label>

          <!-- Discount type* -->
          <label class="com-col-span-1">
            Discount type*
            <nb-select formControlName="discount_type" fullWidth>
              <nb-option value="percent"> Percent </nb-option>
              <nb-option value="value"> Value </nb-option>
            </nb-select>
          </label>

          <!-- Is Limited* -->
          <label class="com-col-span-1">
            Is Limited*
            <input formControlName="is_limited" type="checkbox" />
          </label>
          <!-- Max Limit* -->
          <label
            class="com-col-span-1"
            *ngIf="discountCouponForm.controls.discount_code.get('is_limited').value === true"
          >
            Max Limit*
            <input formControlName="max_limit" nbInput fullWidth type="number" placeholder="Max Limit" />
          </label>

          <!-- Discount value* -->
          <label class="com-col-span-1">
            Discount value*
            <input formControlName="discount_value" fullWidth nbInput type="number" placeholder=" Discount value" />
          </label>

          <!-- Expires At* -->
          <label class="com-col-span-1">
            Expires At*
            <input formControlName="expires_at" fullWidth nbInput type="datetime-local" />
          </label>

          <!-- Event Data Form Entity Group Ids* -->
          <div>
            <label class="com-col-span-1"> Select Form in which you want to apply Coupon* </label>
            <br />
            <nb-tag-list>
              <nb-tag
                *ngFor="let tree of eventDataFormEntityGroups"
                [text]="tree.name"
                [removable]="selectedEventDataFormEntityGroups.includes(tree.id)"
                (click)="addEventDataForm(tree.id)"
              ></nb-tag>
            </nb-tag-list>
          </div>
        </div>
      </form>
    </nb-card-body>
    <nb-card-footer>
      <div class="com-flex com-justify-between com-mx-4">
        <button
          nbButton
          status="primary"
          (click)="data.type === 'edit' ? update(data.id) : create(); ref.close()"
          [disabled]="!discountCouponForm.valid || selectedEventDataFormEntityGroups.length === 0"
        >
          {{ data.type === 'edit' ? 'Update' : data.type }}
        </button>
        <button nbButton status="danger" outline (click)="ref.close(); discountCouponForm.reset()">Cancel</button>
      </div>
    </nb-card-footer>
  </nb-card>
</ng-template>
