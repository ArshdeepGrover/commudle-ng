<nb-card>
  <nb-card-body>
    <table>
      <tr>
        <th width="500px">Name</th>
        <th width="200px">Updates</th>
        <th width="200px">Note</th>
        <th>Application Status</th>
      </tr>
      <tr
        *ngFor="let userResponse of userResponses; let i = index"
        (click)="openDialogBox(userResponseDetailsDialogBox, userResponse.team.id, i)"
        class="com-cursor-pointer"
      >
        <td class="name">
          <div class="team-details">
            <div class="team-name">
              {{ userResponse.team.name }}
            </div>
            <div class="date">
              {{ moment(userResponse.team.created_at).format('DD MMM YYYY') }}
            </div>
          </div>
          <div *ngIf="userResponse.team.round" class="round-name">
            {{ userResponse.team.round?.name }}
          </div>
        </td>

        <td class="updates">
          <div *ngIf="userResponse.team.entity_updates.length > 0">
            <span class="details">{{
              userResponse.team.entity_updates[userResponse.team.entity_updates.length - 1].details
            }}</span>
            <br />
            <span
              class="timeago"
              title="{{
                moment(userResponse.team.entity_updates[userResponse.team.entity_updates.length - 1].created_at).format(
                  'dddd Do MMM, YYYY h:mm A'
                )
              }}"
            >
              {{
                moment(
                  userResponse.team.entity_updates[userResponse.team.entity_updates.length - 1].created_at
                ).fromNow()
              }}
            </span>
          </div>
        </td>
        <td></td>
        <td (click)="$event.stopPropagation()" class="com-cursor-pointer">
          <div
            [class]="EHackathonRegistrationStatusColor[userResponse.team.registration_status]"
            class="select-wrapper"
          >
            <select
              (change)="optionChanged($event, userResponse.team.id, i)"
              [(ngModel)]="userResponse.team.registration_status"
              [class]="EHackathonRegistrationStatusColor[userResponse.team.registration_status]"
            >
              <option
                *ngFor="let registrationStatus of EHackathonRegistrationStatus | keyvalue"
                [value]="registrationStatus.value"
              >
                {{ registrationStatus.value | titlecase }}
              </option>
            </select>
          </div>
        </td>
      </tr>
    </table>
  </nb-card-body>
</nb-card>

<ng-template #userResponseDetailsDialogBox let-ref="dialogRef" let-data>
  <nb-card class="response-dialog-box">
    <nb-card-body>
      <div class="action-buttons">
        <button
          nbButton
          status="primary"
          fullWidth
          (click)="optionChanged(EHackathonRegistrationStatus.ACCEPTED, data.team.id, data.index); ref.close()"
        >
          Accepted
        </button>
        <button
          nbButton
          status="danger"
          fullWidth
          (click)="optionChanged(EHackathonRegistrationStatus.REJECTED, data.team.id, data.index); ref.close()"
        >
          Reject
        </button>
        <button
          nbButton
          status="warning"
          fullWidth
          (click)="optionChanged(EHackathonRegistrationStatus.WAITLISTED, data.team.id, data.index); ref.close()"
        >
          Waitlist
        </button>
      </div>
      <div class="round-select" *ngIf="data.team.registration_status === EHackathonRegistrationStatus.ACCEPTED">
        <select (change)="changeRoundOption($event, data.team.id, data.index)" [(ngModel)]="data.team.round.id">
          <option *ngFor="let hackathonRound of hackathonRounds" [value]="hackathonRound.id">
            {{ hackathonRound.name }}
          </option>
        </select>
      </div>
      <div *ngIf="data.team.entity_updates.length > 0">
        <label>Updates:</label>
        <div *ngFor="let update of data.team.entity_updates">
          <textarea nbInput fullWidth readonly [value]="update.details"></textarea>
        </div>
      </div>
      <div *ngIf="selectedUserDetails.project_description">
        <label>Project Description:</label>
        <textarea type="text" nbInput fullWidth readonly [value]="selectedUserDetails.project_description"> </textarea>
      </div>
      <div class="user-response-details">
        <div class="user-response-tabs">
          <div
            *ngFor="let user of data.userResponse"
            class="user-response-tab"
            [ngClass]="{ active: selectedUserDetails.name === user.name }"
          >
            <div (click)="displayUserData(user)" class="name">{{ user.name }}</div>
          </div>
        </div>
        <div *ngIf="selectedUserDetails">
          <!-- email -->
          <div *ngIf="selectedUserDetails.user_email">
            <label>Email</label>
            <input type="email" nbInput fullWidth readonly [value]="selectedUserDetails.user_email" />
          </div>

          <div *ngIf="selectedUserDetails.about_me">
            <label>About:</label>
            <textarea type="text" nbInput fullWidth readonly [value]="selectedUserDetails.about_me"> </textarea>
          </div>
        </div>
      </div>
    </nb-card-body>
  </nb-card>
</ng-template>
